services:
  fastapi_app:
    # Build from the current directory using uv
    build: .
    ports:
      - "8000:8000"
    restart: unless-stopped
    env_file:
      - .env
    volumes:
      # Mount source code for hot reload during development
      - .:/app
      # Exclude common directories that shouldn't be mounted
      - /app/__pycache__
      - /app/.venv
      - /app/.git
    environment:
      # Ensure Python doesn't write bytecode to mounted volume
      - PYTHONDONTWRITEBYTECODE=1
      # Connect to Brave running on macOS host via a local TCP forwarder:
      # host:9223 -> 127.0.0.1:9222
      #
      # IMPORTANT: Use an IP in the URL to avoid 500 error from Brave's Host header check.
      - PLAYWRIGHT_CDP_URL=http://${HOST_IP}:9223
